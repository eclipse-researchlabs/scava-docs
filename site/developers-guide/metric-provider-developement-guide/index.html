<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Home - Eclipse Scava</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../developers-guide/api-reference-guide/kb/dist/swagger-ui.css" rel="stylesheet">
  <link href="../../developers-guide/api-reference-guide/metric-platform-api/dist/swagger-ui.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "developers-guide/metric-provider-developement-guide/index.md";
    var mkdocs_page_url = "/developers-guide/metric-provider-developement-guide/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Eclipse Scava</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Contributors guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contributors-guide/">Home</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Architecture guidelignes</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/architecture-guidelignes/api-gateway/">Api gateway</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/architecture-guidelignes/authentication/">Authentication</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/architecture-guidelignes/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Contributors guidelignes</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/">Home</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/scava-developement-process/">Scava developement process</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/scava-licensing-recomendation/">Scava licensing recomendation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/scava-naming-recomendations/">Scava naming recomendations</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/scava-repository-organisation/">Scava repository organisation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/contributors-guidelignes/scava-testing-organisation/">Scava testing organisation</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Technical guidelignes</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/access-mongodb-pongo/">Access mongodb pongo</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/api-gateway-configuration/">Api gateway configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/consume-scava-rest-services/">Consume scava rest services</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/">Home</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/rest-api-doc-generation/">Rest api doc generation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/restlet-service-implementation/">Restlet service implementation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../contributors-guide/technical-guidelignes/scava-data-model-extention/">Scava data model extention</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Home</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Api reference guide</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/analysis-platform/">Analysis platform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/api-gateway/">Api gateway</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/">Home</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/knowledge-base/">Knowledge base</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/visualisation-dashboard/">Visualisation dashboard</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api-reference-guide/workflow-engine/">Workflow engine</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Metric provider developement guide</span>
    <ul class="subnav">
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Home</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#metric-provider-developement-guide">Metric Provider Developement Guide</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#pre-requisites">Pre-requisites</a></li>
        
            <li><a class="toctree-l5" href="#the-transient-metric-provider">The Transient Metric Provider</a></li>
        
            <li><a class="toctree-l5" href="#the-historic-metric-provider">The Historic Metric Provider</a></li>
        
            <li><a class="toctree-l5" href="#running-the-metric-providers">Running the metric providers</a></li>
        
            <li><a class="toctree-l5" href="#homework">Homework</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Runing from sources</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../runing-from-sources/administration-application/">Administration application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../runing-from-sources/analysis-platform/">Analysis platform</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../runing-from-sources/eclipse-plugin/">Eclipse plugin</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../runing-from-sources/">Home</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../runing-from-sources/visualisation-dashboard/">Visualisation dashboard</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation-guide/database-backup/">Database backup</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/">Home</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/licencing/">Licencing</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Docker installation</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation-guide/docker-installation/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Platform configuration</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation-guide/platform-configuration/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Platform installation</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation-guide/platform-installation/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Plugin installation</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation-guide/plugin-installation/">Home</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Others</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../others/">Home</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Admin</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../others/admin/API-Gateway-Configuration/">API Gateway Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/admin/Access-to-MongoDB-database-using-PONGO/">Access to MongoDB database using PONGO</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/admin/SCAVA-Administration/">SCAVA Administration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../others/architecture/API-Gateway-Component/">API Gateway Component</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/architecture/Authentication-Component/">Authentication Component</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Deploy</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../others/deploy/Docker-Ossmeter/">Docker Ossmeter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/deploy/Platform-configuration/">Platform configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/deploy/Running-the-platform/">Running the platform</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Component-Naming/">Component Naming</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Contributing/">Contributing</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Development-Guidelines/">Development Guidelines</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Extend-MongoDB-Data-Model/">Extend MongoDB Data Model</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/How-To-Develop-Metric-Provider/">How To Develop Metric Provider</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Implementing-Restlet-Service/">Implementing Restlet Service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Licensing/">Licensing</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Naming-Scava-REST-Services/">Naming Scava REST Services</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Repository-Organisation/">Repository Organisation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/development/Testing-Guidelines/">Testing Guidelines</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Users</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../others/users/Consuming-REST-Services/">Consuming REST Services</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/users/REST-API-Generation/">REST API Generation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/users/Running-Scava-in-Eclipse/">Running Scava in Eclipse</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/users/Scava-Metrics/">Scava Metrics</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../others/users/Scava-Resources/">Scava Resources</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user-guide/">Home</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Administration</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/administration/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Dashboard</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/dashboard/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Indexes</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/indexes/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Metrics</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/metrics/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Plugin</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/plugin/">Home</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Getting started</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../user-guide/plugin/getting-started/">Home</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Quickstart</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/quickstart/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Readers</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/readers/">Home</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Workflow</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-guide/workflow/">Home</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Eclipse Scava</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developers guide &raquo;</li>
        
      
        
          <li>Metric provider developement guide &raquo;</li>
        
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="metric-provider-developement-guide">Metric Provider Developement Guide</h1>
<p>In this tutorial we will implement two metric providers related to the commits that occur in a version control system. The first, a <em>transient</em> metric provider, will keep track of the dates, times, and messages of all commits in the repositories. The second, a <em>historical</em> metric provider, will count the total number of commits over time. </p>
<p>We'll go through the steps above for each metric provider.</p>
<h3 id="pre-requisites">Pre-requisites</h3>
<ul>
<li>Eclipse </li>
<li>The <a href="https://www.eclipse.org/emfatic/">Emfatic</a> plug-in should be installed in your Eclipse</li>
<li>The <a href="https://code.google.com/p/pongo/">Pongo</a> plug-in should be installed in your Eclipse</li>
<li>The OSSMETER source code should be in your workspace</li>
</ul>
<h2 id="the-transient-metric-provider">The Transient Metric Provider</h2>
<p>This metric provider will store a complete history of the commits in the version control system(s) used by a project. </p>
<h3 id="0-setup">0. Setup</h3>
<p>Create a new Plugin project in Eclipse.</p>
<ul>
<li>Go to File &gt; New &gt; Project... and select 'Plug-in project'</li>
<li>Give the project an appropriate name. The OSSMETER naming convention is:<ul>
<li>Transient metrics: org.ossmeter.metricprovider.trans.(metric name)</li>
<li>Historical metrics: org.ossmeter.metricprovider.historical.(metric name)</li>
</ul>
</li>
<li>Click Next</li>
<li>If the "This plug-in will make contributions to the UI" checkbox is ticked, uncheck it</li>
<li>Click Finish</li>
<li>Open up the plugin.xml file in your new project. Open the 'Dependencies' tab and add 'com.googlecode.pongo.runtime', 'org.ossmeter.platform', and 'org.ossmeter.repository.model' to the dependency list.</li>
</ul>
<h3 id="1-the-data-model">1. The data model</h3>
<p>We define the data model using the Emfatic language. In your newly created plug-in, create a package called <code>org.ossmeter.metricprovider.trans.commits.model</code>. In that package create an empty file called <code>commits.emf</code>. In this file, we will define our data model.</p>
<p>First of all, we need to state the name of the package.</p>
<pre><code class="java">package org.ossmeter.metricprovider.trans.commits.model;
</code></pre>

<p>This is used by the Pongo code generator - the generated classes will be put in this package.</p>
<p>We then define the database for our model:</p>
<pre><code class="java">@db(qualifiedCollectionNames=&quot;true&quot;)
class Commits {
    val Repository[*] repositories;
    val Commit[*] commits;
}
</code></pre>

<p>The <code>@db</code> annotation tells Pongo that this will be the container database for the data. Adding the <code>qualifiedCollectionNames=true</code> property will prepend the database name to all Mongo collections. </p>
<p>The <code>Commits</code> class above says that we want a database with two collections, name <code>repositories</code> and <code>commits</code>. If <code>qualifiedCollectionNames</code> is set to <code>true</code>, the collections will be named <code>Commits.repositories</code> and <code>Commits.commits</code>. </p>
<p>We now define the schema of the <code>Commits.repositories</code> collection:</p>
<p>~~~java
class Repository {
    @searchable
    attr String url;
    attr String repoType;
    attr String revision;
    attr int totalNumberOfCommits;
    ref CommitData[*] commits;
}</p>
<pre><code>
This class is used to store information related to the commits in the project's VCS repositories. The collection will contain one entry per VCS repository. Repositories are identified by a `url`, and also have a `repoType` (e.g. Git or SVN), the latest `revision`, the `totalNumberOfCommits`, and a reference to all of the `commits` in the repository, which are stored in the `Commits.commits` collection.

The `@searchable` annotation will make Pongo generate two utility search methods on the collection: `findByUrl(String url) : Iterable&lt;Repository&gt;` and `findOneByUrl(String url) : Repository`. An index will also be create on this field to improve look up time.

Each commit is represented in the `Commits.commits` collection by the following model:

~~~~java
class Commit {
    @searchable
    attr Date date;
    attr String identifier;
    attr String message;
    attr String author;
}
</code></pre>

<p>For each commit, we store its <code>date</code>, <code>identifier</code> (revision ID), the commit <code>message</code>, and the <code>author</code>. We also create an index on the <code>date</code> to allow us to quickly discover the set of commits that occurred on a given date (using the autogenerated <code>findByDate(String date)</code> or <code>findOneByDate(String date)</code> methods).</p>
<p>Now we need to use Pongo to generate code from this model. Right-click on the <code>commits.emf</code> file and select <code>Pongo &gt; Generate Pongos and plugin.xml</code>. You should see some Java classes appear in your package.</p>
<p>Now that we have our data model, we can implement the metric provider.</p>
<h3 id="2-the-metric-provider">2. The metric provider</h3>
<p>Create a Java class called <code>org.ossmeter.metricprovider.trans.commits.CommitsTransientMetricProvider</code></p>
<p>This class should extend <code>AbstractTransientMetricProvider</code> and specify <code>Commits</code> for the generic argument:</p>
<pre><code class="java">public class org.ossmeter.metricprovider.trans.commits.CommitsTransientMetricProvider extends AbstractTransientMetricProvider&lt;Commits&gt;
</code></pre>

<p>The generic argument states that the metric provider stores objects conforming to the <code>Commits</code> data model. Note: You do not need to extend <code>AbstractTransientMetricProvider</code> and can implement <code>ITransientMetricProvider</code> instead should you wish to.</p>
<p>There are a number of methods that need implementing. We will discuss each in turn.</p>
<h4 id="adaptdb-db">adapt(DB db)</h4>
<p>This method returns the Pongo database that the metric provider will use to store its data. This is boilerplate, unfortunately, we can't auto-generate it. Implement as follows:</p>
<pre><code class="java">    @Override
    public Commits adapt(DB db) {
        return new Commits(db);
    }

</code></pre>

<p>The next thing we want to do is fill in useful information that helps users understand the purpose of the metric provider:</p>
<pre><code class="java">    @Override
    public String getShortIdentifier() { // This may be deprecated very soon
        return &quot;transient-commits&quot;; 
    }

    @Override
    public String getFriendlyName() {
        return &quot;Commit History&quot;;
    }

    @Override
    public String getSummaryInformation() {
        return &quot;The commit history of the project.&quot;;
    }
</code></pre>

<p>The next method allows you to declare whether the metric provider is applicable to a given project:</p>
<pre><code class="java">@Override
    public boolean appliesTo(Project project) {
        return project.getVcsRepositories().size() &gt; 0;
    }
</code></pre>

<p>Our metric applies to any project that has at least one VCS repository.</p>
<p>Finally, we have the <code>measure(...)</code> method that performs the actual metric calculation:</p>
<pre><code class="java">    @Override
    public void measure(Project project, ProjectDelta delta, Commits db) {

        for (VcsRepositoryDelta repoDelta : delta.getVcsDelta().getRepoDeltas()) {
            Repository repo = db.getRepositories().findOneByUrl(repoDelta.getRepository().getUrl());

            if (repo == null) {
                repo = new Repository();
                repo.setUrl(repoDelta.getRepository().getUrl());
                db.getRepositories().add(repo);
            }

            for (VcsCommit commit : repoDelta.getCommits()) {
                Commit c = new Commit();
                c.setDate(commit.getJavaDate());
                c.setMessage(commit.getMessage());
                c.setAuthor(commit.getAuthor());
                c.setIdentifier(commit.getRevision());

                repo.getCommits().add(c);
                db.getCommits().add(c);
            }
        }
        db.getCommits().sync();
        db.getRepositories().sync();
    }
</code></pre>

<p>The above method iterates through the delta computed by the platform. The delta consists of the commits that occurred in each of the project's VCS repositories for the date being analysed. A new <code>Commit</code> object is created for each commit in the delta.</p>
<h3 id="3-make-the-metric-provider-discoverable">3. Make the metric provider discoverable</h3>
<p>Metric providers are registered with the OSSMETER platform using <em>extension points</em>:</p>
<ul>
<li>Open up the plugin.xml file and select the 'Extensions' tab</li>
<li>Click the Add button and from the list select <code>org.ossmeter.platform.metricprovider</code></li>
<li>On the right hand side of the editor, you will now see a text box with the label 'provider' and a 'Browse...' button.</li>
<li>Click the 'Browse...' button and select the 'CommitsTransientMetricProvider' class</li>
</ul>
<p>Now everything is ready for the metric to be executed :)</p>
<h2 id="the-historic-metric-provider">The Historic Metric Provider</h2>
<p>This metric provider will keep track of the total number of commits of the project over time. For each date of the project, the metric counts how many commits have been made and stores the value.  </p>
<h3 id="0-setup_1">0. Setup</h3>
<p>Create a new Plugin project in Eclipse.  </p>
<ul>
<li>Go to File &gt; New &gt; Project... and select 'Plug-in project'</li>
<li>Give the project an appropriate name. The OSSMETER naming convention is:<ul>
<li>Transient metrics: org.ossmeter.metricprovider.trans.(metric name)</li>
<li>Historical metrics: org.ossmeter.metricprovider.historical.(metric name)</li>
</ul>
</li>
<li>Click Next</li>
<li>If the "This plug-in will make contributions to the UI" checkbox is ticked, uncheck it</li>
<li>Click Finish</li>
<li>Open up the plugin.xml file in your new project. Open the 'Dependencies' tab and add 'com.googlecode.pongo.runtime', 'org.ossmeter.platform', and 'org.ossmeter.repository.model' to the dependency list.</li>
</ul>
<h3 id="1-the-data-model_1">1. The data model</h3>
<p>In your newly created plug-in, create a package called org.ossmeter.metricprovider.historic.commits.model. In that package create an empty file called historiccommits.emf. In this file, we will define our data model:</p>
<pre><code class="java">package org.ossmeter.metricprovider.historic.commits.model;

class HistoricCommits {
    attr int numberOfCommits;
}
</code></pre>

<p>The data model for the historic metric is much simpler. No Pongo annotations are used because, unlike transient metrics, the platform is responsible for storing the historic data. The data model defined here will be stored against the date that the analysis is performed.</p>
<h3 id="2-the-metric-provider_1">2. The metric provider</h3>
<p>Create a Java class called org.ossmeter.metricprovider.historical.commits.CommitsHistoricalMetricProvider</p>
<p>This class should extend AbstractHistoricalMetricProvider (there are no generic arguments (yet!)):</p>
<p>public class org.ossmeter.metricprovider.trans.commits.CommitsTransientMetricProvider extends AbstractTransientMetricProvider<Commits>
The generic argument states that the metric provider stores objects conforming to the Commits data model. Note: You do not need to extend AbstractTransientMetricProvider and can implement ITransientMetricProvider instead should you wish to.</p>
<p>There are a number of methods that need implementing. We will discuss each in turn.</p>
<p>First of all, complete the typical information-related methods:</p>
<pre><code class="java">    @Override
    public String getShortIdentifier() {
        return &quot;historicalcommits&quot;;
    }

    @Override
    public String getFriendlyName() {
        return &quot;Historical commits&quot;;
    }

    @Override
    public String getSummaryInformation() {
        return &quot;...&quot;;
    }
</code></pre>

<p>Now complete the standard <code>appliesTo</code> method:</p>
<pre><code class="java">    @Override
    public boolean appliesTo(Project project) {
        return project.getVcsRepositories().size() &gt; 0;
    }
</code></pre>

<p>We now need to specify a dependency on the transient metric provider that we just implemented.</p>
<pre><code class="java">    @Override
    public List&lt;String&gt; getIdentifiersOfUses() {
        return Arrays.asList(CommitsTransientMetricProvider.class.getCanonicalName());
    }   
</code></pre>

<p>This tells the platform that we need access to the <code>CommitsTransientMetricProvider</code> database. The platform will assign this to the <code>uses</code> field that is available to the historical metric provider, as you'll see in the <code>measure</code> method:</p>
<pre><code class="java">    @Override
    public Pongo measure(Project project) {
        Commits transDb = (Commits) getDbOfMetricProvider(project, (ITransientMetricProvider) uses.get(0));

        int commits = (int) transDb.getCommits().size();

        HistoricCommits hist = new HistoricCommits();
        hist.setNumberOfCommits(commits);

        return hist;
    }
</code></pre>

<p>First of all, we get hold of the database of the transient commits metric provider, and simply count the size of the <code>commits</code> collection. We save this in an instance of the <code>HistoricCommits</code> Pongo defined above. This object is returned by the method and the platform stores it in the database along with the date that is currently being analysed for the project.</p>
<h3 id="3-make-the-metric-provider-discoverable_1">3. Make the metric provider discoverable</h3>
<p>This process is the same as the transient metric provider:</p>
<ul>
<li>Open up the plugin.xml file and select the 'Extensions' tab</li>
<li>Click the Add button and from the list select <code>org.ossmeter.platform.metricprovider</code></li>
<li>On the right hand side of the editor, you will now see a text box with the label 'provider' and a 'Browse...' button.</li>
<li>Click the 'Browse...' button and select the 'CommitsHistoricalMetricProvider' class</li>
</ul>
<p>Now everything is ready for both metrics to be executed :)</p>
<p>But first. Let's specify how we want this historical metric to be visualised.</p>
<h3 id="4-define-a-metvis-visualisation-specification">4. Define a MetVis visualisation specification</h3>
<p><a href="https://github.com/ossmeter/metvis">MetVis</a> is a JSON-based specification language and visualisation engine for metrics. You specify how the Pongo data model should be transformed into something that can be plotted on a chart. The MetVis <a href="http://jamesrobertwilliams.co.uk/ossmeter/metvis/help.html">web page</a> has numerous examples of this.</p>
<p>Create a folder in your historical metric project called 'vis'. In the 'vis' folder create a file called 'historicalcommits.json'. Here is the MetVis specification for the historical commits metric provider:</p>
<pre><code class="java">{
    &quot;metricid&quot; : &quot;org.ossmeter.metricprovider.historic.commits.CommitsHistoricalMetricProvider&quot;,
    &quot;vis&quot; : [
        {
            &quot;id&quot; : &quot;historicalcommits&quot;,
            &quot;name&quot; : &quot;Commits over time&quot;,
            &quot;description&quot; : &quot;This metric shows when the projects commits occurred&quot;,
            &quot;type&quot; : &quot;LineChart&quot;,
            &quot;datatable&quot; : {
                &quot;cols&quot; : [
                    { &quot;name&quot; : &quot;Date&quot;, &quot;field&quot; : &quot;$__date&quot; },
                    { &quot;name&quot; : &quot;Commits&quot;, &quot;field&quot; : &quot;$numberOfCommits&quot; }
                ]
            },
            &quot;x&quot; : &quot;Date&quot;,
            &quot;y&quot; : &quot;Commits&quot;
        }
    ]
}
</code></pre>

<p>The <code>metricId</code> field tells the platform which metric provider the specification visualises. A metric provider can have multiple visualisations. In this case, we just define one, which plots the date on the X-axis and the number of commits on the Y-axis. Fields in the Pongo data model are references using the $-sign. To access the date field of a historical metric, use <code>$__date</code>. The final two fields (<code>x</code> and <code>y</code>) are references to column names in the datatable specification. The <code>type</code> states that the data should be plotted as a line chart. You can test your MetVis specifications on the <a href="http://jamesrobertwilliams.co.uk/ossmeter/metvis/">MetVis playpen</a>.</p>
<h3 id="5-make-the-visualisation-specification-discoverable">5. Make the visualisation specification discoverable</h3>
<p>As with metric providers, visualisation specifications are registered using extension points.</p>
<ul>
<li>Add the 'org.ossmeter.platform.visualisation' plugin as a dependency on your project</li>
<li>Open up the plugin.xml file and select the 'Extensions' tab</li>
<li>Click the Add button and from the list select <code>org.ossmeter.platform.visualisation.metric</code></li>
<li>On the right hand side of the editor, you will now see a text box with the label 'provider' and a 'Browse...' button.</li>
<li>Click the 'Browse...' button and select the 'historicalcommits.json' file</li>
</ul>
<p>Good job.</p>
<h2 id="running-the-metric-providers">Running the metric providers</h2>
<p>See <a href="../../deploy/Running-the-platform">Running from Source</a></p>
<h2 id="homework">Homework</h2>
<p>Adapt the historical commits metric provider so that it stores the commits for each repository separately (in the above, it sums them all up). Write the MetVis specification - each series should be the commits for separate repositories.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../runing-from-sources/administration-application/" class="btn btn-neutral float-right" title="Administration application">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../api-reference-guide/workflow-engine/" class="btn btn-neutral" title="Workflow engine"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../api-reference-guide/workflow-engine/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../runing-from-sources/administration-application/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="../../developers-guide/api-reference-guide/kb/dist/swagger-ui-bundle.js"></script>
      <script src="../../developers-guide/api-reference-guide/kb/dist/swagger-ui-standalone-preset.js"></script>
      <script src="../../developers-guide/api-reference-guide/kb/dist/swagger-ui.js"></script>
      <script src="../../developers-guide/api-reference-guide/metric-platform-api/dist/swagger-ui-bundle.js"></script>
      <script src="../../developers-guide/api-reference-guide/metric-platform-api/dist/swagger-ui-standalone-preset.js"></script>
      <script src="../../developers-guide/api-reference-guide/metric-platform-api/dist/swagger-ui.js"></script>

</body>
</html>
